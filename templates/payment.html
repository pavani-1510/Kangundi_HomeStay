{% extends "base.html" %}

{% block title %}Payment - Kangundi{% endblock %}

{% block content %}
<div class="payment-page">
    <div class="payment-card">
        <h1>üí≥ Payment (Demo)</h1>
        <p class="meta">Homestay ID: {{ pending.homestay_id }}</p>
        {% if homestay %}
        <p class="meta">Owner: {{ homestay.owner }} | Price: ‚Çπ{{ homestay.price }}/night</p>
        {% endif %}
        <div class="summary">
            <div><strong>From:</strong> {{ pending.from_date }}</div>
            <div><strong>Till:</strong> {{ pending.till_date }}</div>
            <div><strong>Nights:</strong> {{ pending.nights }}</div>
            <div class="total"><strong>Total Amount:</strong> ‚Çπ{{ pending.total_amount }}</div>
        </div>

        <div class="payment-notice">
            <p>‚úÖ <strong>Secure Hosted Checkout (Cashfree)</strong></p>
            <p>UPI, cards, netbanking, wallets ‚Äî choose at checkout.</p>
        </div>

        <button type="button" class="pay-btn" onclick="initiateCashfree()">
            Pay ‚Çπ{{ pending.total_amount }}
        </button>

        <a class="back-link" href="{{ url_for('book_homestay', homestay_id=pending.homestay_id) }}">‚Üê Change dates</a>
    </div>
</div>

<style>
.payment-page { max-width: 640px; margin: 0 auto; padding: 2rem; }
.payment-card { background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 10px 30px rgba(217, 119, 6, 0.12); }
.summary { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem 1rem; margin: 1rem 0; }
.summary .total { grid-column: 1 / -1; background: linear-gradient(135deg, #d97706 0%, #059669 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 1.2rem; }
.payment-notice { background: #dcfce7; padding: 1rem; border-radius: 10px; margin: 1rem 0; border-left: 4px solid #059669; }
.payment-notice p { margin: 0.3rem 0; color: #166534; }
.payment-form { display: flex; flex-direction: column; gap: 1rem; }
.form-group label { font-weight: 600; color: #3d3527; margin-bottom: 0.3rem; display: block; }
.form-group input { width: 100%; padding: 0.85rem 1rem; border: 2px solid #e8dcc8; border-radius: 10px; font-size: 1rem; background-color: #f9f6f0; }
.form-group input:disabled { background-color: #f5f1e8; cursor: not-allowed; }
.form-group input:focus { outline: none; border-color: #d97706; box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.1); }
.pay-btn { padding: 0.95rem 1.4rem; border: none; border-radius: 10px; background: linear-gradient(135deg, #d97706 0%, #059669 100%); color: white; font-weight: 700; cursor: pointer; font-size: 1rem; }
.pay-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(217, 119, 6, 0.25); }
.meta { color: #6b5e4c; margin: 0; }
.back-link { display: inline-block; margin-top: 1rem; color: #d97706; text-decoration: none; font-weight: 600; }
.back-link:hover { text-decoration: underline; }
@media (max-width: 520px) { .summary { grid-template-columns: 1fr; } }
</style>
{% endblock %}

{% block extra_scripts %}
<script>
function initiateCashfree() {
    const orderId = `ORDER_${Date.now()}`;
    const amount = {{ pending.total_amount | float }};
    const customerId = '{{ session.get("user_id") or "guest" }}';
    const phone = '{{ session.get("phone_number") or "9999999999" }}';

    console.log('Payment payload:', { order_id: orderId, amount, customer_id: customerId, phone });

    startCashfreePayment({
        order_id: orderId,
        amount: amount,
        customer_id: customerId,
        phone: phone
    });
}
</script>
{% endblock %}
